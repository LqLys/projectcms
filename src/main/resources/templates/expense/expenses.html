<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Registration Form</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- MDB icon -->
    <link rel="icon" th:href="@{/img/mdb-favicon.ico}" type="image/x-icon">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" th:href="@{/css/mdb.min.css}"/>
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <!-- DataTables CSS -->
    <link rel="stylesheet" th:href="@{/css/addons/datatables.min.css}"/>
    <!-- DataTables JS -->
    <script rel="stylesheet" th:href="@{/js/addons/datatables.min.js}" ></script>
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>

<div th:replace="common/header :: header"></div>


<div class="container-fluid">
    <div class="row mx-sm-4 my-lg-0">
        <div class="col-sm-7">
            <!-- Material form login -->
            <div class="card my-3">

                <h5 class="card-header blue darken-2 white-text text-center py-3">
                    <strong>Znajomi bilans</strong>
                </h5>

                <div class="card-body px-lg-5 pt-0">
                    <div class="table-wrapper-scroll-y my-custom-scrollbar">
                        <table class="table table bordered table-hover" id="myGroups">
                            <thead>
                            <tr>
                                <th>Znajomy</th>
                                <th>Bilans</th>
                            </tr>
                            </thead>
                            <!-- Table head -->

                            <!-- Table body -->
                            <tbody id="demo">
                            <tr th:each="balance :${finalUserBalance}" th:class="balanceRow">
                                <td hidden th:text="${balance.getUserId()}" class="related-id"></td>
                                <td th:text="${balance.getRelatedUser()}" th:class="related-email"></td>
                                <td th:text="${balance.getAmount()}" hidden></td>
                                <td>
                                   <h5 th:classappend="${balance.getAmount() >= 0} ? text-info : text-danger" th:text="${balance.getAmount() + ' zł'}"
                                       class="related-balance">></h5>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-5">
            <div class="card my-3">
                <h5 class="card-header text-white text-center py-3" th:classappend="${totalBalance >= 0} ? green : red">
                    <strong th:text="${'BILANS OGÓLNY:  ' + totalBalance + ' zł'}"></strong>
                </h5>
            </div>
            <!-- Material form login -->
            <div class="card my-3">

                <h5 class="card-header blue darken-2 white-text text-center py-3">
                    <strong>Spłać dług</strong>
                </h5>

                <div class="card-body px-lg-5 pt-0">
                    <form autocomplete="off" action="#" th:action="@{/expenses/pay}"
                          th:object="${payDebtDto}" method="post" class="form-horizontal"
                          role="form">
                    <div class="form-row mb-4 pt-4">
                        <div class="col">
                            <!-- First name -->
                            <input type="text" th:field="*{lenderEmail}" placeholder="Email" class="form-control" id="lenderEmail" readonly/>
                        </div>
                        <div class="col">
                            <!-- Last name -->
                            <input type="number"  th:field="*{amount}" placeholder="Kwota" class="form-control" id="lenderAmount"/>
                        </div>
                    </div>
                    <hr>
                    <button class="btn btn-blue my-4 waves-effect z-depth-0" type="submit" id="paybtn">Wyślij</button>
                    </form>
                </div>
            </div>
            <!--<div class="card my-3">-->

                <!--<h5 class="card-header blue darken-2 white-text text-center py-3">-->
                    <!--<strong>Nowy Wydatek</strong>-->
                <!--</h5>-->

                <!--<div class="card-body px-lg-5 pt-0">-->
                    <!--<div class="form-row mb-4 pt-4">-->
                        <!--<div class="col">-->
                            <!--&lt;!&ndash; First name &ndash;&gt;-->
                            <!--<input type="text" placeholder="Tytuł" class="form-control" />-->
                        <!--</div>-->
                        <!--<div class="col">-->
                            <!--&lt;!&ndash; Last name &ndash;&gt;-->
                            <!--<input type="text"  placeholder="Kwota" class="form-control" />-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<input placeholder="Opis" class="form-control mb-4" />-->
                    <!--<hr>-->
                    <!--<div class="table-wrapper-scroll-y my-custom-scrollbar overflow-auto">-->
                        <!--<table class="table bordered table-hover mb-0" id="testTable">-->
                            <!--&lt;!&ndash; Table head &ndash;&gt;-->
                            <!--<thead>-->
                            <!--<tr class="table-fixed">-->
                                <!--<th>Znajomy</th>-->
                                <!--<th>Uczestnik Wydatku</th>-->
                            <!--</tr>-->
                            <!--</thead>-->
                            <!--&lt;!&ndash; Table head &ndash;&gt;-->

                            <!--&lt;!&ndash; Table body &ndash;&gt;-->
                            <!--<tbody id="members">-->
                            <!--<tr>-->
                                <!--<td >Jacek Placek</td>-->
                                <!--<td>-->
                                    <!--<div class="custom-control custom-checkbox">-->
                                        <!--<input type="checkbox" class="custom-control-input" id="defaultChecked2" checked>-->
                                        <!--<label class="custom-control-label" for="defaultChecked2"></label>-->
                                    <!--</div>-->
                                <!--</td>-->
                            <!--</tr>-->
                            <!--</tbody>-->
                            <!--&lt;!&ndash; Table body &ndash;&gt;-->
                        <!--</table>-->
                        <!--&lt;!&ndash; Table  &ndash;&gt;-->
                    <!--</div>-->
                    <!--<button class="btn btn-blue my-4 waves-effect z-depth-0" type="submit">Utworz</button>-->
                <!--</div>-->
            <!--</div>-->
        </div>
    </div>
</div>



<!--<div class="container">-->
    <!--<div class="row">-->
        <!--<h2 th:text="${'Total balance: ' + totalBalance}"></h2>-->
    <!--</div>-->
    <!--<div class="row">-->
        <!--<div>-->
            <!--<ul class="nav nav-pills nav-justified">-->
                <!--<li class="nav-item">-->
                    <!--<a class="nav-link" th:href="@{/group/details/1/members}">Uczestnicy</a>-->
                <!--</li>-->
                <!--<li class="nav-item">-->
                    <!--<a class="nav-link" th:href="@{/group/details/1}">Szczegóły</a>-->
                <!--</li>-->
                <!--<li class="nav-item">-->
                    <!--<a class="nav-link" th:href="@{/group/details/1/planning}">Planowanie</a>-->
                <!--</li>-->
                <!--<li class="nav-item">-->
                    <!--<a class="nav-link active" th:href="@{/group/details/1/expenses}">Wydatki</a>-->
                <!--</li>-->
                <!--<li class="nav-item">-->
                    <!--<a class="nav-link" th:href="@{/group/details/1/chat}">Chat</a>-->
                <!--</li>-->
            <!--</ul>-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="row">-->
        <!--<div class="col-sm-8">-->
            <!--<h3>ja mam zapłacic innym</h3>-->
            <!--<table class="table">-->

                <!--<tbody>-->
                <!--<tr th:each="exp :${userHasToPay}" style="font-size: x-large">-->

                    <!--<td th:text="${exp.userId}"></td>-->
                    <!--<td th:text="${exp.getRelatedUser()}"></td>-->
                    <!--<td th:text="${exp.getAmount()}"></td>-->

                <!--</tr>-->

                <!--</tbody>-->
            <!--</table>-->
            <!--<h3>inni mają mi zapłacic</h3>-->
            <!--<table class="table">-->

                <!--<tbody>-->
                <!--<tr th:each="expense :${othersHaveToPay}" style="font-size: x-large">-->
                    <!--<td th:text="${expense.userId}"></td>-->
                    <!--<td th:text="${expense.getRelatedUser()}"></td>-->
                    <!--<td th:text="${expense.getAmount()}"></td>-->

                <!--</tr>-->

                <!--</tbody>-->
            <!--</table>-->
            <!--<h3>balans</h3>-->
            <!--<table class="table">-->

                <!--<tbody>-->
                <!--<tr th:each="balance :${finalUserBalance}" style="font-size: x-large" class="balanceRow">-->
                    <!--<td th:text="${balance.userId}"></td>-->
                    <!--<td th:text="${balance.getRelatedUser()}"></td>-->
                    <!--<td th:text="${balance.getAmount()}"></td>-->
                <!--</tr>-->

                <!--</tbody>-->
            <!--</table>-->
        <!--</div>-->
        <!--<div class="col-sm-4">-->
            <!--<div>-->
                <!--<form autocomplete="off" action="#" th:action="@{/expenses/pay}"-->
                      <!--th:object="${payDebtDto}" method="post" class="form-horizontal"-->
                      <!--role="form">-->
                    <!--<h2>Spłać dług</h2>-->
                    <!--<div class="form-group">-->
                        <!--<div class="col-sm-9">-->
                            <!--<label th:if="${#fields.hasErrors('lenderEmail')}" th:errors="*{lenderEmail}"-->
                                   <!--class="validation-message"></label>-->
                            <!--<input type="text" th:field="*{lenderEmail}" placeholder="email" id="lenderEmail" readonly-->
                                   <!--class="form-control"/>-->
                        <!--</div>-->
                        <!--<div class="col-sm-9">-->
                            <!--<label th:if="${#fields.hasErrors('amount')}" th:errors="*{amount}"-->
                                   <!--class="validation-message"></label>-->
                            <!--<input type="text" th:field="*{amount}" placeholder="kwota" id="lenderAmount"-->
                                   <!--class="form-control"/>-->
                        <!--</div>-->


                    <!--</div>-->


                    <!--<div class="form-group">-->
                        <!--<div class="col-sm-9">-->
                            <!--<button type="submit" class="btn btn-primary" id="paybtn">Zapłać!</button>-->
                        <!--</div>-->
                    <!--</div>-->

                    <!--&lt;!&ndash;<span th:utext="${successMessage}"></span>&ndash;&gt;-->


                <!--</form>-->
            <!--</div>-->

        <!--</div>-->
    <!--</div>-->
<!--</div>-->

<script>
    $( document ).ready(function(){
        const balanceRows = $('.balanceRow');
        console.log(balanceRows)
        const userBalance = [];
        var lenderEmail = $('#lenderEmail');
        var lenderAmount = $('#lenderAmount');
        for(var i = 0; i < balanceRows.length; i++){
            const row = balanceRows[i];
            // const userId = $(row).find('.related-id')
            // const userEmail = $(row).find('.related-email')
            // const ammount = +$(row).find('.related-balance')



            const userId = row.children[0].innerText;
            const userEmail = row.children[1].innerText;
            const ammount = +row.children[2].innerText;
            console.log('userId: ', userId);
            console.log('email: ', userEmail);
            console.log('balance: ', ammount);
            userBalance[userEmail] = -ammount;
            if(ammount < 0) {
                balanceRows[i].addEventListener('click', function () {

                    lenderEmail.val(userEmail);
                    lenderEmail.text(userEmail);

                    lenderAmount.val(-ammount);
                    lenderAmount.text(-ammount);
                    console.log(userId);
                    console.log(userEmail);
                    console.log(ammount);

                })
            }
        }
        lenderAmount[0].addEventListener('input', function() {
            var invalid = +lenderAmount.val() > +userBalance[lenderEmail.val()];
            console.log(invalid);
            var payBtn = $("#paybtn");
            if(invalid){
                payBtn.prop('disabled', true);
            }else{
                payBtn.removeAttr('disabled');
            }
        })
    })

</script>

</body>
</html>
